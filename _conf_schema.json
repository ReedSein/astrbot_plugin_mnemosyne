{
    "LLM_providers":{
        "description":"记忆总结使用的LLM服务商",
        "type":"string",
        "hint":"选择用于记忆总结的大语言模型提供商。留空则使用当前会话的默认提供商",
        "_special":"select_provider",
        "default":""
    },
    "embedding_provider_id":{
        "description":"Embedding 服务提供商",
        "type":"string",
        "hint":"选择用于向量嵌入的 Embedding Provider。留空则使用 AstrBot 中配置的第一个 Embedding Provider",
        "default":""
    },
    "embedding_dim":{
        "description":"Embedding 向量维度",
        "type":"int",
        "hint":"必须与 Embedding Provider 的输出维度一致；若已创建 Milvus 集合且维度变化，需要重建集合以避免 dimension mismatch。",
        "obvious_hint":true,
        "default":1024,
        "minimum":1
    },
    "milvus_lite_path":{
        "description":"milvus数据库的lite模式路径",
        "type":"string",
        "hint":"仅使用 milvus_lite_path 或 address 其中一个即可（milvus_lite_path 优先级更高）",
        "obvious_hint":true,
        "default":"",
        "minLength":0
    },
    "address":{
        "description":"milvus数据库地址",
        "type":"string",
        "hint":"支持格式如: http://localhost:19530、https://localhost:19530、localhost:19530",
        "obvious_hint":true,
        "default":"",
        "pattern":"^(https?://)?[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*:[0-9]{1,5}$",
        "minLength":0
    },
    "authentication":{
        "description":"milvus数据库的认证信息",
        "type":"object",
        "hint":"如果milvus开启了服务器认证，请填写对应的信息",
        "obvious_hint":true,
        "items":{
            "token":{
                "description":"milvus数据库的认证token",
                "type":"string",
                "hint":"token优先于账户密码",
                "obvious_hint":true,
                "minLength":0
            },
            "user":{
                "description":"milvus数据库的认证用户名",
                "type":"string",
                "minLength":1
            },
            "password":{
                "description":"milvus数据库的认证密码",
                "type":"string",
                "minLength":0
            }
        }
    },
    "summary_check_task":{
        "description":"自动总结计时器设置",
        "type":"object",
        "hint":"实验性功能：定时检查是否需要进行“漫游增量总结”。不受 num_pairs 影响；若设置了 min_messages_threshold>0，则需要 OneBot/NapCat 漫游的群内新消息条数达到阈值才会总结。总结内容来源于 OneBot/NapCat 群聊漫游（见 onebot_roaming_settings），漫游不可用/失败则跳过本次总结。",
        "obvious_hint":true,
        "items":{
            "SUMMARY_CHECK_INTERVAL_SECONDS":{
                "description":"计时器间隔时间（秒）",
                "type":"int",
                "hint":"默认以每60秒（1分钟）进行检查一次，如果阈值设置为1小时，设置为10分钟应该也没有问题",
                "obvious_hint":true,
                "default":60,
                "minimum":10,
                "maximum":3600
            },
            "SUMMARY_TIME_THRESHOLD_SECONDS":{
                "description":"计时器总结阈值（秒）",
                "type":"int",
                "hint":"默认是3600秒（1小时），设置为-1关闭该功能，每个人与BOT的聊天频率是不同的，按个人需求进行设置",
                "obvious_hint":true,
                "default":-1,
                "minimum":-1
            },
            "max_concurrent_tasks":{
                "description":"最大并发总结任务数",
                "type":"int",
                "hint":"限制同时进行的记忆总结任务数量，防止瞬间并发过高导致 LLM API 报错 (429)。建议默认为 3",
                "obvious_hint":true,
                "default":3,
                "minimum":1,
                "maximum":50
            }
        }
    },
    "collection_name":{
        "description":"向量数据库的集合名称",
        "type":"string",
        "hint":"长期记忆存储在向量数据库的哪个集合中,请使用英文命名",
        "obvious_hint":true,
        "default":"default",
        "pattern":"^[a-zA-Z][a-zA-Z0-9_]*$",
        "minLength":1,
        "maxLength":64
    },
    "use_personality_filtering":{
        "description":"记忆查询时是否使用人格过滤",
        "type":"bool",
        "default":true
    },
    "use_session_filtering":{
        "description":"记忆查询时是否使用会话过滤。如果禁用，所有会话将共享记忆",
        "type":"bool",
        "default":true
    },
    "num_pairs":{
        "description":"记忆总结的对话轮数",
        "type":"int",
        "hint":"用于“触发检查”的对话轮次计数（1轮=一问一答）。当轮次达到此阈值时会触发一次总结检查；若同时设置了 min_messages_threshold>0，则还需要 OneBot/NapCat 漫游的群内新消息条数达到阈值才会真正总结，否则本次不总结并等待下一次轮次触发再检查。",
        "obvious_hint":false,
        "default":5,
        "minimum":1,
        "maximum":25
    },
    "min_messages_threshold":{
        "description":"最小消息数阈值",
        "type":"int",
        "hint":"按“距上次总结后的群内新消息条数”判断是否允许总结（OneBot/NapCat 群聊漫游）。对话触发：需先满足 num_pairs 才会检查该阈值；定时任务：不受 num_pairs 影响，直接检查该阈值。达到阈值才会总结并写入长期记忆；不足则等待下一次触发再检查。0 表示不额外限制。",
        "obvious_hint":true,
        "default":0,
        "minimum":0
    },
    "top_k":{
        "description":"返回的长期记忆的数量",
        "type":"int",
        "default":3,
        "minimum":1,
        "maximum":20
    },
    "contexts_memory_len": {
        "description":"历史上下文中保留的长期记忆数量",
        "type":"int",
        "hint":"<0: 完全保留；=0: 移除所有；>0: 保留最新 N 条（仅影响带 <Mnemosyne> 标签的注入内容）",
        "obvious_hint":true,
        "default":0,
        "minimum":-1
    },
    "memory_injection_method":{
        "description":"记忆插入方式",
        "type":"string",
        "hint":"user_prompt 嵌入用户消息前，system_prompt 嵌入系统消息，insert_system_prompt 添加新系统消息，state_only 仅挂载变量不自动注入",
        "options": ["user_prompt", "system_prompt", "insert_system_prompt", "state_only"],
        "default": "user_prompt"
    },
    "onebot_roaming_settings": {
        "description": "OneBot 漫游消息设置（NapCat/Lagrange 群聊）",
        "type": "object",
        "hint": "开启后，记忆总结的源数据将使用 OneBot 群聊漫游内容（仅 aiocqhttp 群聊可用）。插件会优先提取与机器人相关的消息（机器人发言、@bot 以及必要的上一条用户消息以补齐问答对）。漫游不可用/失败时会跳过本次总结并等待下次触发再检查。",
        "obvious_hint": true,
        "items": {
            "enable": {
                "description": "启用漫游消息拉取（推荐开启）",
                "type": "bool",
                "default": true,
                "hint": "true: 自动总结内容来自 OneBot 群聊漫游；false: 不拉取漫游将导致自动总结无法获取源数据（会跳过总结）。"
            },
            "max_history_limit": {
                "description": "最大回溯消息总数（单次总结）",
                "type": "int",
                "default": 500,
                "minimum": 50,
                "maximum": 2000,
                "hint": "单次总结的拉取上限，超过即截断；过大增加 token 负担，建议结合模型上下文设置（如 300-800）。"
            },
            "batch_size": {
                "description": "单次 API 请求条数（OneBot 调用）",
                "type": "int",
                "default": 50,
                "minimum": 20,
                "maximum": 100,
                "hint": "OneBot `get_group_msg_history` 的 count；过大可能超时，过小会多次请求，默认 50。"
            },
            "first_run_limit": {
                "description": "首次运行拉取限制（last_summary_time=0 时）",
                "type": "int",
                "default": 50,
                "minimum": 10,
                "maximum": 200,
                "hint": "防止首次启动/无总结记录时拉取过多历史导致卡顿；达到该值即停止回溯。"
            }
        }
    },
    "long_memory_prompt":{
        "description":"对话总结提示词",
        "type":"text",
        "hint":"用于总结对话为长期记忆的 system prompt（建议精简，避免 token 开销过大）",
        "obvious_hint":true,
        "default":"请基于以下对话内容生成一段连贯的总结性文字，要求：1. 使用单段自然语言表述，不加序号或分点；2. 聚焦提取核心要素，包括但不限于参与者身份（姓名/角色）、核心事件、关键时间节点、特殊需求、争议点及解决方案；3. 保留涉及金额/数量/规格等量化信息；4.不输出多余的解释性内容；5. 用简洁书面语整合信息，确保信息完整准确。注意：避免添加解释性内容，仅客观呈现对话要素的整合结果。6.以AI的第一人称视角记录信息",
        "minLength":10,
        "maxLength":1000
    },
    "summary_llm_config":{
        "description":"总结 LLM 调用参数",
        "type":"object",
        "hint":"将作为 kwargs 传入总结用 provider 的 text_chat；不同 provider 支持的参数不同。timeout 仅用于本插件的超时控制。",
        "items":{},
        "default":{},
        "template_schema":{
            "timeout":{
                "name":"Timeout",
                "description":"总结超时（秒）",
                "hint":"用于本插件的 asyncio.wait_for；不传则不额外限制",
                "type":"float"
            },
            "temperature":{
                "name":"Temperature",
                "description":"温度参数",
                "hint":"控制输出随机性（是否生效取决于 provider）",
                "type":"float"
            },
            "max_tokens":{
                "name":"Max Tokens",
                "description":"最大输出 token",
                "hint":"限制总结输出长度（是否生效取决于 provider）",
                "type":"int"
            }
        }
    },
    "admin_panel":{
        "description":"管理面板安全配置",
        "type":"object",
        "hint":"配置管理面板的访问控制和安全设置",
        "obvious_hint":true,
        "items":{
            "api_key":{
                "description":"管理面板 API 密钥",
                "type":"string",
                "hint":"用于保护管理面板 API 的访问密钥。留空则每次重启自动生成临时密钥（仅本次运行有效）。如需固定密钥，请在此配置自定义密钥",
                "obvious_hint":true,
                "default":"",
                "minLength":0,
                "maxLength":128
            },
            "port": {
                "description": "管理面板服务器端口",
                "type": "int",
                "hint": "管理面板Web服务器运行的端口，默认为8000。请确保端口未被其他服务占用",
                "obvious_hint": true,
                "default": 8000,
                "minimum": 1024,
                "maximum": 65535
            },
            "host": {
                "description": "管理面板监听地址",
                "type": "string",
                "hint": "管理面板Web服务器监听的IP地址。默认127.0.0.1（仅本机访问），设置为0.0.0.0可允许外部访问（需注意安全风险）",
                "obvious_hint": true,
                "default": "127.0.0.1",
                "pattern": "^(127\\.0\\.0\\.1|0\\.0\\.0\\.0|localhost|((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4})$",
                "minLength": 7,
                "maxLength": 15
            }
        }
    }
}
